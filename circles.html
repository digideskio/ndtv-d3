<!DOCTYPE html>
  <head>
  <meta charset="utf-8">
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="data.json"></script>
    <script>
      var nodes, width, height, container, maxRadius, xScale, yScale, zScale, state, edges;

      var updateCount = function() {
        nodes = [];
        edges = [];
        var node_count = $('#node_count').val();
        for(var i = 1; i <=node_count; i++) {
          var edge_count = Math.floor(Math.random() * 3); 
          var node = {
            key: i, 
            x: {
              1: xScale(Math.random()),
              2: xScale(Math.random()),
            },
            y: {
              1: yScale(Math.random()),
              2: yScale(Math.random()),              
            }, 
            z: {
              1: zScale(Math.random()),
              2: zScale(Math.random()),
            },
            color: "#" + Math.random().toString(16).slice(2, 8) + ""
          }
          for(var e = 0; e < edge_count; e++) {
            // if (e == 0) { return; }
            edges.push({from: i-1, to: Math.floor(Math.random() * node_count )})
          }
          nodes.push(node);
        }
        drawCircles();
      }

      var drawCircles = function() {
        state = state == 1 ? 2 : 1;

        var lines = container.selectAll('line').data(edges);
        lines.enter().append('line')
          .attr({
            stroke: 'gray',
            x1: function(d, i) { return nodes[d.from].x[state]; },
            y1: function(d, i) { return nodes[d.from].y[state]; },
            x2: function(d, i) { return nodes[d.to].x[state]; },
            y2: function(d, i) { return nodes[d.to].y[state]; },
            opacity: 0
          })
        lines.transition()
          .duration(2000)
          .attr({
            x1: function(d, i) { return nodes[d.from].x[state]; },
            y1: function(d, i) { return nodes[d.from].y[state]; },
            x2: function(d, i) { return nodes[d.to].x[state]; },
            y2: function(d, i) { return nodes[d.to].y[state]; },
            opacity: 1
          })
        lines.exit().remove();

        var circles = container.selectAll('circle').data(nodes);
        circles.enter().append('circle')
          .attr("cx", function(d) { return d.x[state]; })
          .attr("cy", function(d) { return d.y[state]; })
          .attr("r", function(d) { return d.z[state]; })
          .attr("fill", function(d) { return d.color; })
          .attr('stroke', 'black')
          .attr('opacity', 0)
        circles.transition()
          .duration(2000)
          .attr("cx", function(d) { return d.x[state]; })
          .attr("cy", function(d) { return d.y[state]; })
          .attr("r", function(d) { return d.z[state]; })
          .attr('opacity', 1)   
        circles.exit().remove();

        var labels = container.selectAll('text').data(nodes);
        labels.enter().append('text')
          .attr("x", function(d) { return d.x[state]; })
          .attr("y", function(d) { return d.y[state]; })
          .text(function(d) { return "Node "+d.key;})
          .attr('opacity', 0) 
        labels.transition()
          .duration(2000)
          .attr("x", function(d) { return d.x[state]; })
          .attr("y", function(d) { return d.y[state]; })
          .attr('opacity', 1)
        labels.exit().remove();

      }

/*      var moveCircles = function() {
        var circles = container.selectAll('circle').data(data);
        circles.transition()
          .duration(2000)
          .attr("cx", function(d) { return d['x'+state]; })
          .attr("cy", function(d) { return d['y'+state]; })
          .attr("r", function(d) { return d['z'+state]; })

        var labels = container.selectAll('text').data(data);
        labels.transition()
          .duration(2000)
          .attr("x", function(d) { return d['x'+state]; })
          .attr("y", function(d) { return d['y'+state]; })

        var lines = container.selectAll('line').data(edges);
        lines.transition()
          .duration(2000)
          .attr({
            x1: function(d, i) { return data[d.from]['x'+state]; },
            y1: function(d, i) { return data[d.from]['y'+state]; },
            x2: function(d, i) { return data[d.to]['x'+state]; },
            y2: function(d, i) { return data[d.to]['y'+state]; },
          })

      }
*/
      $(function() {
        width = $(window).width()-30;
        height = $(window).height()-60;
        minRadius = 15;
        maxRadius = 2;
        state = 1;

        yScale = d3.scale.linear()
          .domain([0,1])
          .range([maxRadius,height-maxRadius]);

        xScale = d3.scale.linear()
          .domain([0,1])
          .range([maxRadius,width-maxRadius]);

        zScale = d3.scale.linear()
          .domain([0,1])
          .range([minRadius, maxRadius]);
        
        container = d3.select("#circles")
          .append("svg:svg")
          .attr("width", width)
          .attr("height", height);
        updateCount();
        $('#circles').on('click', drawCircles)
      })
    </script>
  </head>
  <body>
    # of Nodes <input id='node_count' value='200'/>
    <button onclick="updateCount();">Update</button> Click to animate
    <div id='circles'></div>
  </body>
</html>